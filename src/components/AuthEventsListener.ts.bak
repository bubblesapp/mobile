import React, {useContext, useEffect} from "react";
import {Hub} from "@aws-amplify/core";
import {useAuthState} from "../auth/state/state";
import {Auth} from "aws-amplify";

export const AuthEventsListener: React.FC = (): JSX.Element => {
    const authChannel = "auth";
    const listenerName = "AUTH_LISTENER";
    const [_, authOperations] = useAuthState();

    useEffect(() => {
        let isMounted = true;

        const authEventsCallback = async ({payload: {event}}) => {
            switch (event) {
                case "signIn":
                    console.log("Sign in");
                    authOperations.refresh(Auth);
                    break;
                case "signOut":
                    console.log("Sign out");
                    authOperations.refresh(Auth);
                    break;
            }
        };
        Hub.listen(authChannel, authEventsCallback, listenerName);

        return () => {
            Hub.remove(authChannel, authEventsCallback);
            isMounted = false;
        }
    });
    return null
};